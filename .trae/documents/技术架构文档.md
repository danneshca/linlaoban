# Coze Web SDK æ™ºèƒ½å¯¹è¯åº”ç”¨æŠ€æœ¯æ¶æ„æ–‡æ¡£

## 1. Architecture design

```mermaid
graph TD
    A[ç”¨æˆ·æµè§ˆå™¨] --> B[React å‰ç«¯åº”ç”¨]
    B --> C[Coze Web SDK]
    C --> D[Coze API æœåŠ¡]
    B --> E[æœ¬åœ°å­˜å‚¨]
    
    subgraph "å‰ç«¯å±‚"
        B
        E
    end
    
    subgraph "SDKå±‚"
        C
    end
    
    subgraph "å¤–éƒ¨æœåŠ¡"
        D
    end
```

## 2. Technology Description
- å‰ç«¯ï¼šReact@18 + TypeScript + Tailwind CSS@3 + Vite
- SDKï¼šCoze Web SDK (å®˜æ–¹JavaScriptåº“)
- çŠ¶æ€ç®¡ç†ï¼šZustand
- æœ¬åœ°å­˜å‚¨ï¼šLocalStorage + IndexedDB
- æ„å»ºå·¥å…·ï¼šVite + ESBuild
- ç¯å¢ƒé…ç½®ï¼šdotenv + ç¯å¢ƒå˜é‡ç®¡ç†

## 2.1 å®‰å…¨é…ç½®ç®¡ç†

### ç¯å¢ƒå˜é‡é…ç½®
é¡¹ç›®ä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç†æ•æ„Ÿä¿¡æ¯ï¼Œç¡®ä¿tokenç­‰æœºå¯†æ•°æ®ä¸ä¼šè¢«ç¡¬ç¼–ç åˆ°æºä»£ç ä¸­ã€‚

**ç¯å¢ƒå˜é‡åˆ—è¡¨**
| å˜é‡å | æè¿° | ç¤ºä¾‹å€¼ |
|--------|------|--------|
| VITE_COZE_SAT_TOKEN | Coze SATé‰´æƒtoken | sat_xxx... |
| VITE_COZE_BOT_ID | Cozeæœºå™¨äººID | bot_xxx... |
| VITE_COZE_API_BASE_URL | Coze APIåŸºç¡€URL | https://api.coze.cn |

**é…ç½®æ–‡ä»¶ç»“æ„**
```
é¡¹ç›®æ ¹ç›®å½•/
â”œâ”€â”€ .env.example          # ç¯å¢ƒå˜é‡æ¨¡æ¿æ–‡ä»¶
â”œâ”€â”€ .env.local            # æœ¬åœ°å¼€å‘ç¯å¢ƒå˜é‡ï¼ˆä¸æäº¤ï¼‰
â”œâ”€â”€ .env.production       # ç”Ÿäº§ç¯å¢ƒå˜é‡ï¼ˆä¸æäº¤ï¼‰
â””â”€â”€ .gitignore           # Gitå¿½ç•¥æ–‡ä»¶é…ç½®
```

**.env.example æ¨¡æ¿æ–‡ä»¶**
```bash
# Coze API é…ç½®
VITE_COZE_SAT_TOKEN=your_sat_token_here
VITE_COZE_BOT_ID=your_bot_id_here
VITE_COZE_API_BASE_URL=https://api.coze.cn

# åº”ç”¨é…ç½®
VITE_APP_TITLE=Cozeæ™ºèƒ½å¯¹è¯åº”ç”¨
VITE_APP_VERSION=1.0.0
```

**.env.local æœ¬åœ°å¼€å‘é…ç½®**
```bash
# æœ¬åœ°å¼€å‘ç¯å¢ƒ - è¯·å‹¿æäº¤æ­¤æ–‡ä»¶
VITE_COZE_SAT_TOKEN=sat_P9aesxbg2IKXyDuS70T9ArcaaERxCV2adE7EEtOgbs0ju3BVZ3TDh57JKHjQ4ZBP
VITE_COZE_BOT_ID=your_actual_bot_id
VITE_COZE_API_BASE_URL=https://api.coze.cn
```

**.gitignore é…ç½®**
```gitignore
# ç¯å¢ƒå˜é‡æ–‡ä»¶
.env.local
.env.production
.env.*.local

# ä¾èµ–
node_modules/

# æ„å»ºè¾“å‡º
dist/
build/

# æ—¥å¿—
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# ç¼–è¾‘å™¨
.vscode/
.idea/
*.swp
*.swo

# æ“ä½œç³»ç»Ÿ
.DS_Store
Thumbs.db
```

### å®‰å…¨æœ€ä½³å®è·µ

1. **Tokenç®¡ç†åŸåˆ™**
   - ğŸš« **ç»ä¸**å°†tokenç¡¬ç¼–ç åˆ°æºä»£ç ä¸­
   - âœ… ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨æ‰€æœ‰æ•æ„Ÿä¿¡æ¯
   - âœ… æä¾›.env.exampleæ¨¡æ¿æ–‡ä»¶ä¾›å›¢é˜Ÿä½¿ç”¨
   - âœ… å°†æ‰€æœ‰.env.*æ–‡ä»¶æ·»åŠ åˆ°.gitignoreä¸­

2. **å¼€å‘ç¯å¢ƒé…ç½®**
   ```bash
   # 1. å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
   cp .env.example .env.local
   
   # 2. ç¼–è¾‘.env.localæ–‡ä»¶ï¼Œå¡«å…¥çœŸå®çš„tokenå€¼
   # 3. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
   npm run dev
   ```

3. **ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²**
   - åœ¨éƒ¨ç½²å¹³å°ï¼ˆå¦‚Vercelã€Netlifyï¼‰çš„ç¯å¢ƒå˜é‡è®¾ç½®ä¸­é…ç½®token
   - ç¡®ä¿ç”Ÿäº§ç¯å¢ƒtokenä¸å¼€å‘ç¯å¢ƒåˆ†ç¦»
   - å®šæœŸè½®æ¢tokenä»¥æé«˜å®‰å…¨æ€§

4. **ä»£ç ä¸­çš„å®‰å…¨ä½¿ç”¨**
   ```javascript
   // âœ… æ­£ç¡®ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡
   const token = import.meta.env.VITE_COZE_SAT_TOKEN;
   
   // ğŸš« é”™è¯¯ï¼šç¡¬ç¼–ç token
   const token = 'sat_P9aesxbg2IKXyDuS70T9ArcaaERxCV2adE7EEtOgbs0ju3BVZ3TDh57JKHjQ4ZBP';
   
   // âœ… æ­£ç¡®ï¼šæ·»åŠ ç¯å¢ƒå˜é‡æ£€æŸ¥
   if (!import.meta.env.VITE_COZE_SAT_TOKEN) {
     throw new Error('VITE_COZE_SAT_TOKEN environment variable is required');
   }
   ```

5. **å›¢é˜Ÿåä½œè§„èŒƒ**
   - æ–°æˆå‘˜åŠ å…¥æ—¶ï¼Œæä¾›ç¯å¢ƒå˜é‡é…ç½®æŒ‡å—
   - å®šæœŸæ£€æŸ¥ä»£ç ï¼Œç¡®ä¿æ²¡æœ‰ç¡¬ç¼–ç çš„æ•æ„Ÿä¿¡æ¯
   - ä½¿ç”¨ä»£ç å®¡æŸ¥æµç¨‹ï¼Œé˜²æ­¢æ•æ„Ÿä¿¡æ¯æ³„éœ²

## 3. Route definitions
| Route | Purpose |
|-------|----------|
| / | ä¸»é¡µé¢ï¼Œæ™ºèƒ½å¯¹è¯ç•Œé¢å’Œæ ¸å¿ƒåŠŸèƒ½ |
| /history | å¯¹è¯å†å²é¡µé¢ï¼ŒæŸ¥çœ‹å’Œç®¡ç†å†å²è®°å½• |
| /settings | è®¾ç½®é¡µé¢ï¼Œä¸ªäººé…ç½®å’ŒAIåŠ©æ‰‹è®¾ç½® |
| /admin | ç®¡ç†åå°ï¼Œç³»ç»Ÿç®¡ç†å’Œæ•°æ®ç»Ÿè®¡ |
| /login | ç™»å½•é¡µé¢ï¼Œç”¨æˆ·è®¤è¯ |

## 4. API definitions
### 4.1 Core API

**Coze Web SDK é›†æˆ**
```javascript
// SDK åˆå§‹åŒ– - ä½¿ç”¨ç¯å¢ƒå˜é‡
CozeWebSDK.init({
  token: process.env.VITE_COZE_SAT_TOKEN,
  botId: process.env.VITE_COZE_BOT_ID,
  baseURL: process.env.VITE_COZE_API_BASE_URL || 'https://api.coze.cn'
})
```

**å¯¹è¯æ¥å£**
```
POST /v1/conversation/chat
```

Request:
| Param Name | Param Type | isRequired | Description |
|------------|------------|------------|-------------|
| message | string | true | ç”¨æˆ·è¾“å…¥çš„æ¶ˆæ¯å†…å®¹ |
| conversation_id | string | false | ä¼šè¯IDï¼Œç”¨äºç»´æŒå¯¹è¯ä¸Šä¸‹æ–‡ |
| user_id | string | false | ç”¨æˆ·æ ‡è¯†ç¬¦ |
| stream | boolean | false | æ˜¯å¦å¯ç”¨æµå¼å“åº” |

Response:
| Param Name | Param Type | Description |
|------------|------------|-------------|
| message | string | AIå›å¤çš„æ¶ˆæ¯å†…å®¹ |
| conversation_id | string | ä¼šè¯ID |
| status | string | å“åº”çŠ¶æ€ |

Example:
```json
{
  "message": "ä½ å¥½ï¼Œæˆ‘æ˜¯AIåŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ",
  "conversation_id": "conv_123456",
  "status": "success"
}
```

**æ–‡ä»¶ä¸Šä¼ æ¥å£**
```
POST /v1/files/upload
```

Request:
| Param Name | Param Type | isRequired | Description |
|------------|------------|------------|-------------|
| file | File | true | ä¸Šä¼ çš„æ–‡ä»¶å¯¹è±¡ |
| purpose | string | true | æ–‡ä»¶ç”¨é€”ï¼ˆå¦‚ï¼šchat, knowledgeï¼‰ |

Response:
| Param Name | Param Type | Description |
|------------|------------|-------------|
| file_id | string | æ–‡ä»¶å”¯ä¸€æ ‡è¯†ç¬¦ |
| filename | string | æ–‡ä»¶åç§° |
| size | number | æ–‡ä»¶å¤§å° |
| url | string | æ–‡ä»¶è®¿é—®é“¾æ¥ |

## 5. Server architecture diagram
ç”±äºé‡‡ç”¨çº¯å‰ç«¯æ¶æ„ï¼Œç›´æ¥é€šè¿‡Coze Web SDKä¸CozeæœåŠ¡é€šä¿¡ï¼Œæ— éœ€ç‹¬ç«‹åç«¯æœåŠ¡ã€‚

```mermaid
graph TD
    A[æµè§ˆå™¨å®¢æˆ·ç«¯] --> B[Reactåº”ç”¨å±‚]
    B --> C[ä¸šåŠ¡é€»è¾‘å±‚]
    C --> D[SDKæ¥å£å±‚]
    D --> E[Coze APIæœåŠ¡]
    
    subgraph "å‰ç«¯æ¶æ„"
        B
        C
        D
    end
    
    subgraph "æ•°æ®å­˜å‚¨"
        F[LocalStorage]
        G[IndexedDB]
    end
    
    C --> F
    C --> G
```

## 6. Data model

### 6.1 Data model definition
```mermaid
erDiagram
    USER ||--o{ CONVERSATION : has
    CONVERSATION ||--|{ MESSAGE : contains
    USER ||--o{ USER_SETTINGS : has
    MESSAGE ||--o{ FILE_ATTACHMENT : includes
    
    USER {
        string id PK
        string username
        string email
        string avatar_url
        datetime created_at
        datetime last_active
    }
    
    CONVERSATION {
        string id PK
        string user_id FK
        string title
        datetime created_at
        datetime updated_at
        boolean is_archived
    }
    
    MESSAGE {
        string id PK
        string conversation_id FK
        string content
        string role
        datetime timestamp
        string message_type
    }
    
    USER_SETTINGS {
        string id PK
        string user_id FK
        string theme
        string language
        json ai_preferences
        datetime updated_at
    }
    
    FILE_ATTACHMENT {
        string id PK
        string message_id FK
        string filename
        string file_url
        number file_size
        string file_type
    }
```

### 6.2 Data Definition Language
ç”±äºé‡‡ç”¨å‰ç«¯å­˜å‚¨æ–¹æ¡ˆï¼Œä½¿ç”¨LocalStorageå’ŒIndexedDBè¿›è¡Œæ•°æ®ç®¡ç†ï¼š

**LocalStorage å­˜å‚¨ç»“æ„**
```javascript
// ç”¨æˆ·è®¾ç½®
const userSettings = {
  theme: 'light', // light | dark
  language: 'zh-CN',
  aiPreferences: {
    model: 'gpt-4',
    temperature: 0.7,
    maxTokens: 2000
  }
};

// å½“å‰ä¼šè¯çŠ¶æ€
const currentSession = {
  conversationId: 'conv_123456',
  userId: 'user_789',
  lastActivity: '2024-01-15T10:30:00Z'
};
```

**IndexedDB æ•°æ®åº“ç»“æ„**
```javascript
// æ•°æ®åº“ï¼šCozeAppï¼Œç‰ˆæœ¬ï¼š1

// å¯¹è±¡å­˜å‚¨ï¼šconversations
const conversationStore = {
  keyPath: 'id',
  indexes: [
    { name: 'userId', keyPath: 'userId' },
    { name: 'createdAt', keyPath: 'createdAt' },
    { name: 'updatedAt', keyPath: 'updatedAt' }
  ]
};

// å¯¹è±¡å­˜å‚¨ï¼šmessages
const messageStore = {
  keyPath: 'id',
  indexes: [
    { name: 'conversationId', keyPath: 'conversationId' },
    { name: 'timestamp', keyPath: 'timestamp' },
    { name: 'role', keyPath: 'role' }
  ]
};

// å¯¹è±¡å­˜å‚¨ï¼šfiles
const fileStore = {
  keyPath: 'id',
  indexes: [
    { name: 'messageId', keyPath: 'messageId' },
    { name: 'fileType', keyPath: 'fileType' }
  ]
};
```

**åˆå§‹åŒ–æ•°æ®**
```javascript
// é»˜è®¤ç³»ç»Ÿé…ç½® - æ•æ„Ÿä¿¡æ¯é€šè¿‡ç¯å¢ƒå˜é‡è·å–
const defaultConfig = {
  cozeToken: process.env.VITE_COZE_SAT_TOKEN, // ä»ç¯å¢ƒå˜é‡è·å–
  apiBaseUrl: process.env.VITE_COZE_API_BASE_URL || 'https://api.coze.cn',
  maxConversations: 100,
  maxMessagesPerConversation: 1000,
  supportedFileTypes: ['txt', 'pdf', 'doc', 'docx', 'jpg', 'png'],
  maxFileSize: 10 * 1024 * 1024 // 10MB
};

// ç¤ºä¾‹å¯¹è¯æ•°æ®
const sampleConversation = {
  id: 'conv_sample_001',
  userId: 'user_demo',
  title: 'æ¬¢è¿ä½¿ç”¨AIåŠ©æ‰‹',
  createdAt: new Date().toISOString(),
  updatedAt: new Date().toISOString(),
  isArchived: false
};

const sampleMessages = [
  {
    id: 'msg_001',
    conversationId: 'conv_sample_001',
    content: 'ä½ å¥½ï¼æ¬¢è¿ä½¿ç”¨Coze AIåŠ©æ‰‹',
    role: 'assistant',
    timestamp: new Date().toISOString(),
    messageType: 'text'
  }
];
```